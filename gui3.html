<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>TwoRavens</title>

    <link rel="shortcut icon" href="images/favicon.ico?v=1" type="image/x-icon">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="app.css">

    <link rel="stylesheet" href="Ladda/dist/ladda-themeless.min.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery.ui.all.css">

    <script src="Ladda/dist/spin.min.js"></script>
    <script src="Ladda/dist/ladda.min.js"></script>

    <script type="text/javascript" src="jquery/jquery.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-1.12.4.js"></script> -->

    <!--Used for right panel query tree-->
    <script src="jqtree/tree.jquery.js"></script>
    <link rel="stylesheet" href="jqtree/jqtree.css">
    <link rel="stylesheet" href="jqtree/jqtree.style.css">

    <!--NOTE: JQuery-ui must be loaded before bootstrap-->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="d3.v3.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    <!-- <script type="text/javascript" src="plots.js"></script> -->
</head>

<!--svg id="accidents">
<defs>
   <linearGradient id="fade" x1="0%" y1="50%" x2="50%" y2="100%">
     <stop offset="0%" style="stop-color:#F5A9A9" />
     <stop offset="100%" style="stop-color:#D8F6CE" />
   </linearGradient>
</defs>
</svg-->

  <body>

    <nav id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">
        <a class="navbar-brand" style="margin-left:0">
            <img src="images/TwoRavens.png" alt="TwoRavens" width="100" style="margin-left:2em;margin-top:-0.5em;"
                 onmouseover="about();" onmouseout="closeabout();">
        </a>
        <div id="navbarNav" style="margin-top:11px">
            <label class="btn btn-default ladda-button navbar-right" style="margin-left:2em;margin-right:1em;"
                    id="btnEstimate" onclick="estimate('btnEstimate')" data-spinner-color="#000000"
                    data-style="zoom-in"><span class="ladda-label">Subset</span></label>
            <button class="btn btn-default navbar-right" id="btnReset" title="Reset" onclick="reset()"
                    style="margin-left:2.0em;"><span style="font-size:1em;color:#818181; pointer-events:none;"
                                                     class="glyphicon glyphicon-repeat"></span></button>
            <!--<div id="transformations" class="transformTool"-->
            <!--title="Construct transformations of existing variables using valid R syntax. For example, assuming a variable named d, you could enter 'log(d)' or 'd^2'.">-->
            <!--</div>-->

            <!-- HIDE THE DATA BROWSER BUTTON FOR NOW
            <button class="btn btn-default" id="makeTable" title="Make Table" style="margin-left:1em;"><span style="font-size:1em;color:#818181; pointer-events:none;" class="glyphicon glyphicon-list-alt"></span></button>
-->
        </div>
        <div id="about" class="panel panel-default" style="width:500px;display:None;z-index:50;">
            <div class="panel-body"> </div>
        </div>

    </nav>

    <div id="leftpanel" class="sidepanel container clearfix">

        <div id="toggleLpanelicon" class="panelbar"><span>&#9679;<br/>&#9679;<br/>&#9679;<br/>&#9679;</span></div>
        <div class="panel-heading text-center" id="leftpaneltitle">
            <h3 class="panel-title">Data Selection</h3>
        </div>

        <div class="btn-toolbar" role="toolbar" style="margin-left:6px;">
            <div class="btn-group" style="width:calc(100% - 12px)">
                <button type="button" class="btn active" id="btnVariables" title="Click variable name to add or remove the variable pebble from the modeling space." onclick="tabLeft('tab1');">Variables</button>
                <button type="button" class="btn btn-default" id="btnSubset" onclick="tabLeft('tab2');">Subsets</button>
            </div>
            <button type="button" class="btn btn-default ladda-button" id="btnSelect" title="Subset data by the intersection of all selected values." style="display:none; float:right; margin-right:10px" onclick="subsetSelect('btnSelect');" data-spinner-color="#000000" data-style="zoom-in"><span class="ladda-label" style="pointer-events:none;">Select</span></button>
        </div>
        <div class="row-fluid">
            <div id="leftpanelcontent">
                <div id="leftContentArea">
                    <div id="tab1" style="display:block;padding:10px 8px;text-align:center;width:100%;">

                        <input type="text" id="searchvar" placeholder="Search Variables and Labels" class="form-control" style="width:100%; margin-bottom:5px;"/>
                        <div id="variableList" style="display:inline;text-align:center;position:absolute;left:6px;top:128px;height:calc(100% - 128px);width:226px;overflow-y:scroll"></div>
                    </div>
                    <div id="tab2" style="display:none; margin-top:.5em;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="rightpanel" class="sidepanel container clearfix">

        <div id="toggleRpanelicon" class="panelbar"><span>&#9679;<br/>&#9679;<br/>&#9679;<br/>&#9679;</span></div>

        <div class="panel-heading text-center" id="rightpaneltitle">
            <h3 class="panel-title">Query Summary</h3>
        </div>

        <div id="queryVariables" style="margin-left:5px;width:232px;height:calc(50% - 39px);overflow-y:auto">
            <h4 class="panel-title">Variables</h4>
            <div id="variableTree" style="margin-left:10px;width:calc(100% - 15px);height:calc(100% - 19px);overflow-y:auto"></div>
        </div>

        <div id="querySubsets" style="width:232px;height:calc(50% - 39px);">
            <h4 class="panel-title" style="margin-left:5px;">Subsets</h4>
            <div id="subsetTree" style="height:calc(100% - 19px);overflow-y:auto"></div>
        </div>
        <div id="rightpanelButtonBar" style="width:232px;position:absolute;bottom:5px">
            <button id="buttonAddGroup" class="btn btn-default ladda-button" data-spinner-color="#000000"
                    onclick="addGroup()" type="button"
                    style="float:left;margin-left:6px;">Group
            </button>
            <button id="buttonSubmitQuery" class="btn btn-default ladda-button" data-spinner-color="#000000"
                    onclick="submitQuery()" type="button"
                    style="float:right;margin-right:5px">Submit
            </button>
        </div>
    </div>

    <button id="stageButton" class="btn btn-default" type="button" onclick=addRule()>Stage</button>

    <div id="ticker" class="ticker">
        <a href="somelink" target="_blank" id="logID">Replication</a>
    </div>

    <div id="popoverContainer"></div>

    <div id="main" class="left" onresize=rightpanelMargin()>

        <div id="subsetDate" class="canvas" style="display:none">
            <svg id="dateSVG" width="500" height="500"></svg>

            <div id="dateInterval" class="form-group" style="display: inline-block;vertical-align:top;width:20%;margin:20px">
                <button id="setDatefromSlider" type="button" class="btn btn-default" onclick="setDatefromSlider()" style="margin-top:10px;text-align:center;">Bring Date from Slider</button>
                <label id="dateFromLab" for="fromdate" style="text-align:left;width:100%;margin-top:10px;" >From:</label>
                <input id="fromdate" class="form-control" type="text">
                <label id="dateToLab" for="todate" style="text-align:left;width:100%;margin-top:10px;">To:</label>
                <input id="todate" class="form-control" type="text">
            </div>
        </div>

        <div id="subsetLocation" class="canvas" style="display:none">
        </div>

        <div id="subsetAction" class="canvas" style="display:none">
        </div>

        <div id="subsetActor" class="canvas" style="display:none">
			<div id="actorContainer">

			<div id="actorSelectionDiv">
				<div id="actorSelectionTitle" class="panel-heading text-center">
					<h3 class="panel-title">Actor Selection</h3>
				</div>
				
				<div id="tabDiv" style="overflow:hidden;">
					<div class="actorTab">
						<button id="sourceTabBtn" class="actorTabLink btn active" type="button" onclick="actorTabSwitch('sourceTabBtn', 'sourceDiv')" title="Select sources">Sources</button>
						<button id="targetTabBtn" class="actorTabLink btn btn-default" type="button" onclick="actorTabSwitch('targetTabBtn', 'targetDiv')" title="Select targets">Targets</button>
					</div>
				</div>

				<div id="groupNameDisplayContainer" class="panel-heading text-center" style="padding-bottom:0px;">
					<input id="editGroupName" type="text" placeholder="Source 0" data-toggle="tooltip" title="Click to change group name"/>	<!--change placeholder on group -->
					<button id="deleteGroup" type="button" data-toggle="tooltip" title="Delete current group"></button>
				</div>

				<div id="fullContainer">
					<div id="sourceDiv" class="actorTabContent">
						<div id="allSources" class="actorLeft">
							<input id="sourceSearch" class="form-control actorSearch" placeholder="Search source actors" type="text"/>
							
							<div id="searchListSources" class="actorFullList">
								<!--checks will be added dynamically in JS once at load-->
							</div>
						</div>

						<div class="actorRight">
							<button id="clearAllSources" type="button" data-toggle="tooltip" class="clearActorBtn" title="Clears search text and filters">Clear All Filters</button>
							
							<div id="sourceFilter" class="actorFilterList">
								<label title="Show selected sources" data-toggle="tooltip" class="actorShowSelectedLbl actorChkLbl"><input class="actorChk actorShowSelected" name="sourceShowSelected" id="sourceShowSelected" type="checkbox" value="show" onchange="showSelected(this)">Show Selected</label>
								<div class="seperator"></div>
								
								<!--dynamically add checks for filters at load-->
								<button id="entitySourceExpand" class="filterExpand" value="expand"></button>
								<label id="entitySources" class="actorHead4" for="entitySourceExpand"><b>Entity</b></label>
								<div id="wrapEntitySource" class="filterContainer" style="padding-left:10px;">
										<button id="orgSourceExpand" class="filterExpand" value="expand"></button>
										<label class="actorChkLbl"><input class="actorChk allCheck" name="sourceOrgAllCheck" id="sourceOrgAllCheck" type="checkbox" value="organizations">Organizations</label>
										<div id="orgSourcesList" class="filterContainer" style="padding-left:30px;"></div>

										<div class="seperator"></div>

										<button id="countrySourceExpand" class="filterExpand" value="expand"></button>
										<label class="actorChkLbl"><input class="actorChk allCheck" name="sourceCountryAllCheck" id="sourceCountryAllCheck" type="checkbox" value="countries">Countries</label>
										<div id="countrySourcesList" class="filterContainer" style="padding-left:30px;"></div>
								</div>

								<div class="seperator"></div>

								<button id="roleSourceExpand" class="filterExpand" value="expand"></button>
								<label id="roleSources" class="actorHead4" for="roleSourceExpand"><b>Role</b></label>
								<div id="roleSourcesList" class="filterContainer"></div>

								<div class="seperator"></div>
								
								<button id="attributeSourceExpand" class="filterExpand" value="expand"></button>
								<label id="attributeSources" class="actorHead4" for="attributeSourceExpand"><b>Attributes</b></label>
								<div id="attributeSourcesList" class="filterContainer"></div>
							</div>
						</div>

						<button id="sourceSelectAll" class="actorBottom actorSelectAll" type="button" data-toggle="tooltip" title="Selects all sources that match the filter criteria">Select All</button>

						<button id="sourceClearSel" class="actorBottom actorClearAll" type="button" data-toggle="tooltip" title="Clears all sources that match the filter criteria">Clear All</button>

						<button id="sourceNew" class="actorBottom actorNewGroup" type="button" data-toggle="tooltip" title="Create new source group">New Source Group</button>
					</div>

					<div id="targetDiv" class="actorTabContent">
						<div id="allTargets" class="actorLeft">
							<input id="targetSearch" class="form-control actorSearch" placeholder="Search target actors" type="text">
							
							<div id="searchListTargets" class="actorFullList">
								<!--checks will be added dynamically in JS once at load-->
							</div>
						</div>

						<div class="actorRight">
							<button id="clearAllTargets" type="button" data-toggle="tooltip" class="clearActorBtn" title="Clears search text and filters">Clear All Filters</button>
							
							<div id="targetFilter" class="actorFilterList">
								<label title="Show selected targets" data-toggle="tooltip" class="actorShowSelectedLbl actorChkLbl"><input class="actorChk actorShowSelected" name="targetShowSelected" id="targetShowSelected" type="checkbox" value="show" onchange="showSelected(this)">Show Selected</label>
								<div class="seperator"></div>
								
								<!--dynamically add checks for filters at load-->
								<button id="entityTargetExpand" class="filterExpand" value="expand"></button>
								<label id="entityTargets" class="actorHead4" for="entityTargetExpand"><b>Entity</b></label>
								<div id="wrapEntityTarget" class="filterContainer" style="padding-left:10px;">
										<button id="orgTargetExpand" class="filterExpand" value="expand"></button>
										<label class="actorChkLbl"><input class="actorChk allCheck" name="targetOrgAllCheck" id="targetOrgAllCheck" type="checkbox" value="organizations">Organizations</label>
										<div id="orgTargetsList" class="filterContainer" style="padding-left:30px;"></div>

										<div class="seperator"></div>

										<button id="countryTargetExpand" class="filterExpand" value="expand"></button>
										<label class="actorChkLbl"><input class="actorChk allCheck" name="targetCountryAllCheck" id="targetCountryAllCheck" type="checkbox" value="countries">Countries</label>
										<div id="countryTargetsList" class="filterContainer" style="padding-left:30px;"></div>
								</div>

								<div class="seperator"></div>

								<button id="roleTargetExpand" class="filterExpand" value="expand"></button>
								<label id="roleTargets" class="actorHead4" for="roleTargetExpand"><b>Role</b></label>
								<div id="roleTargetsList" class="filterContainer"></div>

								<div class="seperator"></div>
								
								<button id="attributeTargetExpand" class="filterExpand" value="expand"></button>
								<label id="attributeTargets" class="actorHead4" for="attributeTargetExpand"><b>Attributes</b></label>
								<div id="attributeTargetsList" class="filterContainer"></div>
							</div>
						</div>

						<button id="targetSelectAll" class="actorBottom actorSelectAll" type="button" data-toggle="tooltip" title="Selects all targets that match the filter criteria">Select All</button>

						<button id="targetClearSel" class="actorBottom actorClearAll" type="button" data-toggle="tooltip" title="Clears all targets that match the filter criteria">Clear All</button>

						<button id="targetNew" class="actorBottom actorNewGroup" type="button" data-toggle="tooltip" title="Create new target group">New Target Group</button>
					</div>
                </div>
            </div>

            <div id="actorLinkDiv">
				<div id="linkTitle">
					<h3 id="linkTitleLeft" class="panel-title text-center">Sources</h3>
					<h3 id="linkTitleRight" class="panel-title text-center">Targets</h3>
				</div>
				
				<svg id="actorLinkSVG"></svg>
            </div>
        </div>
        </div>

        <div id="legend" class="legendary panel panel-default" style="display:none">
            <div class="panel-heading">
                <h3 class="panel-title">Legend  <span class="glyphicon glyphicon-large glyphicon-chevron-down pull-right" style="cursor: pointer; cursor: hand;" data-toggle="collapse" data-target="#collapseLegend"
                href="#collapseLegend" onclick="$(this).toggleClass('glyphicon-chevron-up').toggleClass('glyphicon-chevron-down');"></span></h3>
            </div>
          <div id="collapseLegend" class="panel-collapse collapse in">
              <div class="panel-body">
                  <div id="timeButton" class="clearfix hide">
                      <div class="rectColor">
                        <!-- <svg style="width:20px;height:20px;">
                          <circle cx="10" cy="10" r="9" stroke="black" stroke-width="2" fill="white" />
                        </svg>
 -->                      </div> <div class="rectLabel">Time</div>
                  </div>
                  <div id="csButton" class="clearfix hide">
                      <div class="rectColor">
                        <!-- <svg style="width:20px;height:20px;">
                          <circle cx="10" cy="10" r="9" stroke="black" stroke-width="2" fill="white" />
                        </svg> -->
                      </div> <div class="rectLabel">Cross Sec</div>
                  </div>
                  <div id="dvButton" class="clearfix hide">
                      <div class="rectColor">
                        <!-- <svg style="width:20px;height:20px;">
                          <circle cx="10" cy="10" r="9" stroke="black" stroke-width="2" fill="white" />
                        </svg> -->
                      </div> <div class="rectLabel">Dep Var</div>
                  </div>
                  <div id="nomButton" class="clearfix hide">
                      <div class="rectColor">
                        <!-- <svg style="width:20px;height:20px;">
                          <circle cx="10" cy="10" r="9" stroke="black" stroke-width="2" fill="white" />
                        </svg> -->
                      </div> <div class="rectLabel">Nom Var</div>
                  </div>
              </div>
            </div>
        </div>

        <div id="logdiv" class="logbox panel panel-default" style="display:none">
            <div class="panel-heading">
                <h3 class="panel-title">History <span id="logicon" class="glyphicon glyphicon-large glyphicon-chevron-down pull-right" style="cursor: pointer; cursor: hand;" data-toggle="collapse" data-target="#collapseLog" href="#collapseLog" onclick="$(this).toggleClass('glyphicon-chevron-down').toggleClass('glyphicon-chevron-up');"></span></h3>
            </div>
            <div id="collapseLog" class="panel-collapse collapse in">
              <div class="panel-body">
              </div>
            </div>
        </div>

        <!--<div id="tooltip" style="display: none;">
         <h3 class="popover-title">Summary Statistics</h3>
         <div id="tooltiptext" class="popover-content form-horizontal"></div>
         </div>-->

    </div>

<script>
//     closeRightPanel();
// Open/Close Panels
  $('#leftpanel span').click(function(){
      closeLeftPanel();
  });
  $('#rightpanel span').click(function(){
      closeRightPanel();
  });

  function closeLeftPanel() {
      if ($('#leftpanel').hasClass('forceclosepanel')) {
        // do nothing
      } else {
          /*$('#leftpanel .btn-toolbar').hide();*/
          $('#leftpanel').removeClass('expandpanel');
          $('#leftpanel > div.row-fluid').toggleClass('closepanel');
          $('#leftpanel').toggleClass('closepanel');
      }
  }

function closeRightPanel() {
    if ($('#rightpanel').hasClass('forceclosepanel')) {
        // do nothing
    } else {
        /*$('#rightpanel .nav-tabs').hide();*/
        $('#rightpanel').removeClass('expandpanel');
        $('#rightpanel > div.row-fluid').toggleClass('closepanel');
        $('#rightpanel').toggleClass('closepanel');
        rightpanelMargin();
    }
}

  var myurl=window.location.toString();
  var fileid="";
  var cindex=0;
  if (myurl.indexOf("dfId=") > 0) {
    fileid=myurl.substring(myurl.indexOf("dfId=")+5);
    cindex=fileid.indexOf("&");
    if (cindex > 0) {
      fileid=fileid.substring(0,cindex);
    }
  }
  var hostname="";
  if (myurl.indexOf("host=") > 0) {
    hostname=myurl.substring(myurl.indexOf("host=")+5);
    cindex=hostname.indexOf("&");
    if (cindex > 0) {
      hostname=hostname.substring(0,cindex);
    }
  }
  var apikey="";
  if (myurl.indexOf("key=") > 0) {
    apikey=myurl.substring(myurl.indexOf("key=")+4);
    cindex=apikey.indexOf("&");
    if (cindex > 0) {
      apikey=apikey.substring(0,cindex);
    }
  }
  var ddiurl="";
  if (myurl.indexOf("ddiurl=") > 0) {
    ddiurl=myurl.substring(myurl.indexOf("ddiurl=")+7);
    ddiurl=ddiurl.replace(/%25/g,"%");
    ddiurl=ddiurl.replace(/%3A/g,":");
    ddiurl=ddiurl.replace(/%2F/g,"/");
    cindex=ddiurl.indexOf("&");
    if (cindex > 0) {
      ddiurl=ddiurl.substring(0,cindex);
    }
  }
  var dataurl="";
  if (myurl.indexOf("dataurl=") > 0) {
    dataurl=myurl.substring(myurl.indexOf("dataurl=")+8);
    dataurl=dataurl.replace(/%25/g,"%");
    dataurl=dataurl.replace(/%3A/g,":");
    dataurl=dataurl.replace(/%2F/g,"/");
    cindex=dataurl.indexOf("&");
    if (cindex > 0) {
      dataurl=dataurl.substring(0,cindex);
    }
  }

  var username="";
  if (myurl.indexOf("username=") > 0) {
    username=myurl.substring(myurl.indexOf("dataurl=")+8);
    username=username.replace(/%25/g,"%");
    username=username.replace(/%3A/g,":");
    username=username.replace(/%2F/g,"/");
    username=username.indexOf("&");
    if (cindex > 0) {
      username=username.substring(0,cindex);
    }
  }
  else{username="rohit";}


//  console.log("fileid: "+fileid);
//  console.log("hostname: "+hostname);
//  console.log("apikey: "+apikey);
//  console.log("ddiurl: "+ddiurl);
//  console.log("dataurl: "+dataurl);
//  console.log("Username:"+username);

	//switches tabs in actor subset
	function actorTabSwitch(origin, tab) {
		switch(origin) {
			case "sourceTabBtn":
//				console.log("switching to source");
				document.getElementById("targetDiv").style.display = "none";
				$("#targetTabBtn").removeClass("active").addClass("btn-default");
				$("#sourceTabBtn").removeClass("btn-default").addClass("active");
				break;
			default:
//				console.log("switching to target");
				document.getElementById("sourceDiv").style.display = "none";
				$("#sourceTabBtn").removeClass("active").addClass("btn-default");
				$("#targetTabBtn").removeClass("btn-default").addClass("active");
				break;
		}

		document.getElementById(tab).style.display = "inline-block";
	}

	//expands divs with filters
	$(".filterExpand").click(function() {
		if (this.value == "expand") {
			this.value = "collapse";
			$(this).css("background-image", "url(collapse.png)");
			$(this).next().next("div.filterContainer").show("fast");
		}
		else {
			this.value = "expand";
			$(this).css("background-image", "url(expand.png)");
			$(this).next().next("div.filterContainer").hide("fast");
		}
	});

</script>

    <script src="app_ddi_eventdata.js"></script>
    <script src="app_ddi_eventdata_date.js"></script>
    <script src="app_ddi_eventdata_query.js"></script>

    <script type="text/javascript" src="d3.v3.min.js"></script>
    <script id="actorCodeJS" type="text/javascript" src="app_ddi_eventdata_actor.js"></script>

  </body>
</html>

